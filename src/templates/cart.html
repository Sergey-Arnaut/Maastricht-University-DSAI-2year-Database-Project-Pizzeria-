{% extends "base.html" %}
{% block title %}Cart{% endblock %}
{% block content %}
<h1>Cart</h1>

{% if rows %}
<table class="table table-sm align-middle">
  <thead>
    <tr>
      <th>Type</th><th>Name</th><th>Size</th><th>Qty</th><th>Unit (€)</th><th>Line (€)</th><th></th>
    </tr>
  </thead>
  <tbody>
  {% for r in rows %}
    <tr>
      <td>
        {% if r.kind == 'P' %}Pizza{% elif r.kind == 'D' %}Drink{% else %}Dessert{% endif %}
      </td>
      <td>
        {{ r.name }}
        {% if r.kind == 'P' and r.extras %}
          <div class="small text-muted">
            Extras:
            {% for iid, q in r.extras.items %}
              <span class="badge bg-light text-dark me-1">#{{ iid }} × {{ q }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </td>
      <td>{% if r.size %}{{ r.size }}{% else %}—{% endif %}</td>
      <td>{{ r.qty }}</td>
      <td>{{ r.unit }}</td>
      <td>{{ r.sum }}</td>
      <td>
        <form method="post" action="{% url 'remove_cart_item' r.kind r.id %}">
          {% csrf_token %}
          <button class="btn btn-outline-danger btn-sm">Remove</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </tbody>
  <tfoot>
    <tr><th colspan="5" class="text-end">Subtotal:</th><th>{{ subtotal }}</th><th></th></tr>
  </tfoot>
</table>

<div class="d-flex gap-3">
  <form method="post" action="{% url 'clear_cart' %}">
    {% csrf_token %}
    <button class="btn btn-outline-secondary">Clear</button>
  </form>

  <form method="post" action="{% url 'checkout' %}" class="d-flex gap-2">
    {% csrf_token %}
    <input type="text" name="discount_code" placeholder="Voucher code" class="form-control" style="max-width:200px">
    <button class="btn btn-success">Place order</button>
  </form>
</div>

{% else %}
<p class="text-muted">Cart is empty.</p>
{% endif %}

<p class="mt-3"><a class="btn btn-secondary" href="{% url 'menu' %}">Back to menu</a></p>
{% endblock %}
